<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Little Pearly Daily Lucky</title>
</head>
<body>
<div class="lp-wrap">
  <!-- ë°°ê²½(ì´ë¯¸ì§€) ìœ„ì— í´ë¦­ UIë¥¼ ì–¹ëŠ” â€œì”¬â€ -->
  <div class="lp-scene" id="lpScene" aria-label="ë¦¬í‹€í„ë¦¬ ì˜¤ëŠ˜ì˜ í–‰ìš´ ë½‘ê¸°">
    <!-- 10ê°œ ìŠ¬ë¡¯(ì´ë¯¸ì§€ ìœ„ì¹˜ì— ë§ì¶° absolute ë°°ì¹˜) -->
    <button class="lp-clover" type="button" data-slot="0" aria-label="ë„¤ìí´ë¡œë²„ 1"></button>
    <button class="lp-clover" type="button" data-slot="1" aria-label="ë„¤ìí´ë¡œë²„ 2"></button>

    <button class="lp-clover" type="button" data-slot="2" aria-label="ë„¤ìí´ë¡œë²„ 3"></button>
    <button class="lp-clover" type="button" data-slot="3" aria-label="ë„¤ìí´ë¡œë²„ 4"></button>
    <button class="lp-clover" type="button" data-slot="4" aria-label="ë„¤ìí´ë¡œë²„ 5"></button>
    <button class="lp-clover" type="button" data-slot="5" aria-label="ë„¤ìí´ë¡œë²„ 6"></button>

    <button class="lp-clover" type="button" data-slot="6" aria-label="ë„¤ìí´ë¡œë²„ 7"></button>
    <button class="lp-clover" type="button" data-slot="7" aria-label="ë„¤ìí´ë¡œë²„ 8"></button>
    <button class="lp-clover" type="button" data-slot="8" aria-label="ë„¤ìí´ë¡œë²„ 9"></button>
    <button class="lp-clover" type="button" data-slot="9" aria-label="ë„¤ìí´ë¡œë²„ 10"></button>

    <!-- ì•ˆë‚´ í…ìŠ¤íŠ¸(í…ŒìŠ¤íŠ¸ìš©: í™”ë©´ ì•„ë˜ ì‘ê²Œ) -->
    <div class="lp-help" id="lpHelp"></div>
  </div>

  <!-- íŒì—…(ì´ë¯¸ì§€ ë™ì¼í•˜ê²Œ: modal.pngë¥¼ ì¹´ë“œ ë°°ê²½ìœ¼ë¡œ ì‚¬ìš©) -->
  <div class="lp-modal" id="lpModal" aria-hidden="true">
    <div class="lp-modal__dim" data-close></div>
    <div class="lp-modal__card" role="dialog" aria-modal="true" aria-labelledby="lpModalTitle">
      <!-- ë°°ê²½ ì´ë¯¸ì§€ë¥¼ ì“°ëŠ” ì¹´ë“œë¼, í…ìŠ¤íŠ¸ëŠ” ì ‘ê·¼ì„±/SEOìš©ìœ¼ë¡œë§Œ ìˆ¨ê¹€ ì²˜ë¦¬ -->
      <h2 class="sr-only" id="lpModalTitle">ë‹¹ì²¨ ì•ˆë‚´</h2>
      <p class="sr-only">ì¶•í•˜ë“œë¦½ë‹ˆë‹¤. ì ë¦½ê¸ˆì´ ì§€ê¸‰ë˜ì—ˆìŠµë‹ˆë‹¤.</p>

      <!-- ì‹¤ì œ í‘œì‹œ í…ìŠ¤íŠ¸(ì´ë¯¸ì§€ ìœ„ì— ì •í™•íˆ ì–¹ê¸°) -->
      <div class="lp-modal__overlay">
        <div class="lp-modal__headline">ì§ ! ì¶•í•˜ë“œë¦½ë‹ˆë‹¤!</div>
        <div class="lp-modal__sub">
          ì ë¦½ê¸ˆ <span class="lp-modal__amount" id="lpModalAmount">0ì›</span> ë‹¹ì²¨!
        </div>
        <div class="lp-modal__divider"></div>

        <div class="lp-modal__fine">
          í•´ë‹¹ ì ë¦½ê¸ˆì€ 30ì¼ ì´ë‚´ì— ì‚¬ìš© ê°€ëŠ¥í•˜ë©°,<br />
          ë§ˆì´í˜ì´ì§€ì—ì„œ í™•ì¸ ê°€ëŠ¥í•©ë‹ˆë‹¤!
        </div>
      </div>

      <button class="lp-modal__btn" type="button" data-close aria-label="í™•ì¸">í™•ì¸</button>
    </div>
  </div>
</div>

<style>
  /* =========================
     Design Tokens (ì´ë¯¸ì§€ í†¤)
  ========================== */
  :root{
    --pink:#ff86b6;          /* ìƒë‹¨ë°”/ë©”ì¸í•‘í¬ */
    --pink-deep:#ff4f9a;
    --blue:#79d2ff;          /* í•˜ëŠ˜ìƒ‰ í´ë¡œë²„ */
    --green:#79ff61;         /* 500ì› ê¸€ì ê°™ì€ ë„¤ì˜¨ê·¸ë¦° */
    --shadow: 0 18px 50px rgba(0,0,0,.28);
  }

  /* í˜ì´ì§€ ì–´ë””ì— ë„£ì–´ë„ í­ì— ë§ê²Œ ë°˜ì‘í˜• */
  .lp-wrap{
    width: 100%;
    margin: 0 auto;
  }

  /* =========================
     Scene (ë°°ê²½ ì´ë¯¸ì§€)
     - ë°˜ì‘í˜• í•µì‹¬: aspect-ratio ìœ ì§€ + 100% í­
  ========================== */
  .lp-scene{
    position: relative;
    width: min(1200px, 100%);   /* PCì—ì„œëŠ” ìµœëŒ€í­ ì œí•œ */
    margin: 0 auto;
    aspect-ratio: 16 / 9;       /* ì œê³µ ì´ë¯¸ì§€ê°€ 16:9 ê³„ì—´ì´ë¼ ê°€ì • */
    background-image: url("./playground.png");
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    overflow: hidden;
    border-radius: 0;           /* ì´ë¯¸ì§€ì²˜ëŸ¼ ê½‰ ì°¨ëŠ” ëŠë‚Œ(í•„ìš” ì‹œ ìˆ˜ì •) */
  }

  /* í…ŒìŠ¤íŠ¸ìš© ì•ˆë‚´ */
  .lp-help{
    position:absolute;
    left: 50%;
    bottom: 2%;
    transform: translateX(-50%);
    font-size: clamp(12px, 1.3vw, 14px);
    color: rgba(0,0,0,.55);
    text-align:center;
    padding: 6px 10px;
    border-radius: 999px;
    background: rgba(255,255,255,.55);
    backdrop-filter: blur(6px);
  }

  /* =========================
     Clover Buttons
     - â€œí¼ì„¼íŠ¸ ì¢Œí‘œâ€ë¡œ ë°°ì¹˜ (JSì—ì„œ top/left ì£¼ì…)
     - ì‚¬ì´ì¦ˆëŠ” clampë¡œ ë””ë°”ì´ìŠ¤ì— ë§ê²Œ ìë™ ìŠ¤ì¼€ì¼
  ========================== */
  .lp-clover{
    position:absolute;
    width: clamp(44px, 6vw, 86px);
    height: clamp(44px, 6vw, 86px);
    border:0;
    background: transparent;
    cursor:pointer;
    transform: translate(-50%, -50%);
    transform-origin: 50% 50%;
    padding: 0;
  }

  /* í•˜ëŠ˜ìƒ‰ ë„¤ìí´ë¡œë²„ (ì´ë¯¸ì§€ ëŠë‚Œ) */
  .lp-clover::before{
    content:"";
    position:absolute;
    inset: 0;
    margin:auto;
    width: 86%;
    height: 86%;
    background: var(--blue);
    border-radius: 18px;
    clip-path: path("M36 10 C26 0 10 6 10 22 C10 32 18 38 24 40 C18 42 10 48 10 60 C10 76 26 82 36 72 C46 82 62 76 62 60 C62 48 54 42 48 40 C54 38 62 32 62 22 C62 6 46 0 36 10 Z");
    box-shadow: 0 10px 18px rgba(0,0,0,.06);
  }

  /* í´ë¦­ í›„ í•‘í¬ ë„¤ì */
  .lp-clover.is-won::before{
    background: var(--pink);
  }

  /* ê°€ìš´ë° ê¸ˆì•¡ í‘œì‹œ */
  .lp-clover .lp-amount{
    position:absolute;
    inset:0;
    display:flex;
    align-items:center;
    justify-content:center;
    font-weight: 1000;
    font-size: clamp(14px, 2.2vw, 20px);
    color: #fff;
    text-shadow: 0 2px 0 rgba(0,0,0,.08);
  }

  /* íšŒì „ ì• ë‹ˆë©”ì´ì…˜(ì˜¤ë¥¸ìª½) + ê°ì† */
  .lp-clover.is-spinning{
    animation: lpSpinStop 3s cubic-bezier(0.12, 0.72, 0.08, 1) forwards;
  }
  @keyframes lpSpinStop{
    0%   { transform: translate(-50%,-50%) rotate(0deg) scale(1); }
    10%  { transform: translate(-50%,-50%) rotate(360deg) scale(1.03); }
    40%  { transform: translate(-50%,-50%) rotate(1440deg) scale(1.03); }
    70%  { transform: translate(-50%,-50%) rotate(2160deg) scale(1.02); }
    100% { transform: translate(-50%,-50%) rotate(2520deg) scale(1); }
  }

  .lp-clover:disabled{
    cursor:not-allowed;
    opacity:.55;
  }

  /* =========================
     Modal (ì´ë¯¸ì§€ ë™ì¼ ìŠ¤íƒ€ì¼)
  ========================== */
  .lp-modal{
    position:fixed;
    inset:0;
    display:none;
    z-index:99999;
  }
  .lp-modal.is-open{ display:block; }

  .lp-modal__dim{
    position:absolute;
    inset:0;
    background: rgba(0,0,0,.35);
  }

  .lp-modal__card{
    position:absolute;
    left:50%;
    top:50%;
    transform: translate(-50%,-50%);
    width: min(520px, calc(100% - 32px));
    aspect-ratio: 1 / 1;              /* ì œê³µ â€œë‹¹ì²¨ ì°½â€ì´ ì •ì‚¬ê°í˜• ëŠë‚Œ */
    border-radius: 28px;
    overflow:hidden;
    box-shadow: var(--shadow);
    background-image: url("./modal.png");
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
  }

  /* ì´ë¯¸ì§€ ìœ„ì— í…ìŠ¤íŠ¸ë¥¼ â€œì •ë ¬â€í•´ì„œ ì–¹ê¸° */
  .lp-modal__overlay{
    position:absolute;
    inset: 0;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:flex-start;
    padding: 12% 10% 14%;
    color:#fff;
    text-align:center;
  }

  .lp-modal__headline{
    font-weight: 1000;
    font-size: clamp(22px, 4.2vw, 40px);
    margin-top: 4%;
    letter-spacing: -0.02em;
  }

  .lp-modal__sub{
    margin-top: 4%;
    font-weight: 1000;
    font-size: clamp(18px, 3.6vw, 34px);
    letter-spacing: -0.02em;
  }

  .lp-modal__amount{
    color: var(--green);
    text-shadow: 0 2px 0 rgba(0,0,0,.08);
  }

  /* ì´ë¯¸ì§€ì˜ í° ë¼ì¸ ëŠë‚Œ */
  .lp-modal__divider{
    margin-top: 8%;
    width: 100%;
    height: 4px;
    border-radius: 999px;
    background: rgba(255,255,255,.95);
  }

  .lp-modal__fine{
    margin-top: auto;
    margin-bottom: 16%;
    font-weight: 800;
    font-size: clamp(14px, 2.4vw, 20px);
    line-height: 1.35;
    opacity: .95;
  }

  .lp-modal__btn{
    position:absolute;
    left: 50%;
    bottom: 6%;
    transform: translateX(-50%);
    width: 44%;
    height: clamp(40px, 8vw, 56px);
    border-radius: 999px;
    border: 0;
    background: rgba(255,255,255,.92);
    color: var(--pink-deep);
    font-weight: 1000;
    font-size: clamp(14px, 2.4vw, 18px);
    cursor:pointer;
    box-shadow: 0 10px 18px rgba(0,0,0,.12);
  }

  /* ì ‘ê·¼ì„±: í™”ë©´ì—” ìˆ¨ê¸°ë˜ ë¦¬ë”ì—” ì½í˜ */
  .sr-only{
    position:absolute !important;
    width:1px; height:1px;
    padding:0; margin:-1px;
    overflow:hidden; clip:rect(0,0,0,0);
    white-space:nowrap; border:0;
  }

  /* =========================
     Breakpoints (í•„ìš” ì‹œ ë¯¸ì„¸ì¡°ì •)
     - íƒœë¸”ë¦¿/ëª¨ë°”ì¼ì—ì„œ ë²„íŠ¼ì´ ë„ˆë¬´ ì‘ì•„ì§€ì§€ ì•Šê²Œ
  ========================== */
  @media (max-width: 768px){
    .lp-scene{ width: 100%; }
    .lp-help{ bottom: 1.5%; }
  }

  @media (max-width: 420px){
    /* ë„ˆë¬´ ì‘ì€ í°ì—ì„œ ëˆ„ë¥´ê¸° ì‰½ê²Œ ì•½ê°„ í‚¤ì›€ */
    .lp-clover{
      width: clamp(48px, 13vw, 64px);
      height: clamp(48px, 13vw, 64px);
    }
  }
</style>

<script>
(() => {
  /* =========================
     1) íšŒì› ì²´í¬ (GitHub í…ŒìŠ¤íŠ¸ìš©)
     - ìš´ì˜(ì•„ì„ì›¹) ì˜¬ë¦´ ë• TEST_USER ì œê±°í•˜ê³  ì‹¤ì œ íšŒì›ê°’ìœ¼ë¡œ ë³€ê²½
  ========================== */
  function getMemberId() {
    // GitHub í…ŒìŠ¤íŠ¸ìš©
    return "TEST_USER";

    // ìš´ì˜ìš© ì˜ˆì‹œ(ì•„ì„ì›¹ì—ì„œ ì‹¤ì œ ê°’ í™•ì¸ í›„ ì‚¬ìš©)
    // if (window.IMWEB_MEMBER && (IMWEB_MEMBER.id || IMWEB_MEMBER.member_code || IMWEB_MEMBER.email)) {
    //   return IMWEB_MEMBER.id || IMWEB_MEMBER.member_code || IMWEB_MEMBER.email;
    // }
    // return null;
  }

  const memberId = getMemberId();
  const helpEl = document.getElementById("lpHelp");
  const modalEl = document.getElementById("lpModal");
  const modalAmountEl = document.getElementById("lpModalAmount");
  const clovers = Array.from(document.querySelectorAll(".lp-clover"));

  /* =========================
     2) â€œì´ë¯¸ì§€ ê¸°ì¤€â€ í´ë¡œë²„ ì¢Œí‘œ (í¼ì„¼íŠ¸)
     - í˜„ì¬ ë†€ì´í„° ì´ë¯¸ì§€ ê¸°ì¤€ìœ¼ë¡œ ëŒ€ëµ ë§ì¶˜ ê°’
     - ë„¤ê°€ ë³´ëŠ” í™”ë©´ì—ì„œ ì‚´ì§ ì–´ê¸‹ë‚˜ë©´ ì´ ê°’ë§Œ ë¯¸ì„¸ì¡°ì •í•˜ë©´ ë.
  ========================== */
  const SLOT_POS = [
    { left: 46.0, top: 35.0 }, // 0 (ìƒë‹¨ ì™¼ìª½)
    { left: 54.0, top: 35.0 }, // 1 (ìƒë‹¨ ì˜¤ë¥¸ìª½)

    { left: 30.5, top: 56.0 }, // 2
    { left: 42.5, top: 56.0 }, // 3
    { left: 54.5, top: 56.0 }, // 4
    { left: 66.5, top: 56.0 }, // 5

    { left: 30.5, top: 74.5 }, // 6
    { left: 42.5, top: 74.5 }, // 7
    { left: 54.5, top: 74.5 }, // 8
    { left: 66.5, top: 74.5 }, // 9
  ];

  // ì¢Œí‘œ ì ìš©
  clovers.forEach(btn => {
    const i = Number(btn.dataset.slot);
    const p = SLOT_POS[i];
    btn.style.left = p.left + "%";
    btn.style.top  = p.top  + "%";
  });

  /* =========================
     3) í•˜ë£¨ 1íšŒ ì œí•œ (ë¡œì»¬)
  ========================== */
  const todayKey = new Date().toISOString().slice(0,10);
  const storageKey = memberId ? `LP_LUCKY_${memberId}_${todayKey}` : null;

  function hasClaimedToday() {
    if (!storageKey) return false;
    return localStorage.getItem(storageKey) === "claimed";
  }
  function markClaimed() {
    if (!storageKey) return;
    localStorage.setItem(storageKey, "claimed");
  }

  /* =========================
     4) í™•ë¥  ëª¨ë¸
     - 100ì›: 80%
     - 1000ì›: 0.1%
     - 110~990: ë‚˜ë¨¸ì§€ 19.9%ë¥¼ 110ì´ ê°€ì¥ ë†’ê³  990ì´ ê°€ì¥ ë‚®ê²Œ(ì§€ìˆ˜ê°ì†Œ)
  ========================== */
  const P_100 = 0.80;
  const P_1000 = 0.001;
  const P_MID_TOTAL = 1 - P_100 - P_1000; // 0.199

  const mids = [];
  for (let v = 110; v <= 990; v += 10) mids.push(v);

  const ratio = 800; // 110 : 990 â‰ˆ 800ë°°
  const n = mids.length;
  const weights = mids.map((_, i) => Math.pow(ratio, -i / (n - 1)));
  const wSum = weights.reduce((a,b) => a+b, 0);
  const midProb = weights.map(w => (w / wSum) * P_MID_TOTAL);

  const cdf = [];
  let acc = 0;

  acc += P_100;
  cdf.push({ amount: 100, acc });

  for (let i=0; i<mids.length; i++){
    acc += midProb[i];
    cdf.push({ amount: mids[i], acc });
  }

  cdf.push({ amount: 1000, acc: 1 });

  function drawAmount(){
    const r = Math.random();
    for (const row of cdf){
      if (r <= row.acc) return row.amount;
    }
    return 100;
  }

  /* =========================
     5) Modal open/close
  ========================== */
  function openModal(amount){
    modalAmountEl.textContent = `${amount.toLocaleString()}ì›`;
    modalEl.classList.add("is-open");
    modalEl.setAttribute("aria-hidden", "false");
  }
  function closeModal(){
    modalEl.classList.remove("is-open");
    modalEl.setAttribute("aria-hidden", "true");
  }
  modalEl.addEventListener("click", (e) => {
    if (e.target.matches("[data-close]")) closeModal();
  });

  /* =========================
     6) í´ë¦­ ë¡œì§
     - íšŒì›ë§Œ / í•˜ë£¨ 1íšŒ / 3ì´ˆ íšŒì „ / í•‘í¬ + ê¸ˆì•¡ / 1ì´ˆ ë’¤ íŒì—…
  ========================== */
  if (!memberId){
    helpEl.textContent = "ë¡œê·¸ì¸ í›„ ì°¸ì—¬í•  ìˆ˜ ìˆì–´ìš”!";
    clovers.forEach(b => b.disabled = true);
    return;
  }

  if (hasClaimedToday()){
    helpEl.textContent = "ì˜¤ëŠ˜ì€ ì´ë¯¸ ì°¸ì—¬í–ˆì–´ìš”! ë‚´ì¼ ë˜ ì™€ì£¼ì„¸ìš” ğŸ’—";
    clovers.forEach(b => b.disabled = true);
    return;
  }

  helpEl.textContent = "í•˜ëŠ˜ìƒ‰ ë„¤ìí´ë¡œë²„ë¥¼ ëˆŒëŸ¬ ì˜¤ëŠ˜ì˜ í–‰ìš´ì„ ë½‘ì•„ë³´ì„¸ìš”!";

  let locked = false;

  clovers.forEach(btn => {
    btn.addEventListener("click", async () => {
      if (locked) return;
      locked = true;

      clovers.forEach(b => b.disabled = true);

      const amount = drawAmount();

      // 3ì´ˆ íšŒì „
      btn.classList.add("is-spinning");

      setTimeout(() => {
        btn.classList.remove("is-spinning");
        btn.classList.add("is-won");

        const amountEl = document.createElement("div");
        amountEl.className = "lp-amount";
        amountEl.textContent = `${amount.toLocaleString()}ì›`;
        btn.appendChild(amountEl);
      }, 3000);

      // 1ì´ˆ ë’¤ íŒì—…(ì´ 4ì´ˆ í›„)
      setTimeout(() => {
        markClaimed();
        openModal(amount);
        helpEl.textContent = "ë‚´ì¼ë„ ë‹¤ì‹œ ì°¸ì—¬í•  ìˆ˜ ìˆì–´ìš”!";
      }, 4000);
    });
  });
})();
</script>


</body>
</html>
